<div class="animate-fade-in-down p-4">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-primary">Catálogo Bibliográfico</h1>
    @if (isAdmin) {
      <button
        class="btn btn-secondary shadow-md gap-2"
        (click)="abrirModalRegistro()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="size-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 4.5v15m7.5-7.5h-15"
          />
        </svg>
        Nuevo Libro
      </button>
    }
  </div>

  @if (loading) {
    <div class="flex justify-center py-20">
      <span class="loading loading-bars loading-lg text-primary"></span>
    </div>
  }

  <div
    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6"
  >
    @for (book of books; track book.idLibro) {
      <div
        class="card bg-base-100 shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 border border-base-200 overflow-hidden group h-full flex flex-col"
      >
        <figure
          class="aspect-[2/3] relative overflow-hidden bg-base-200/30 w-full"
        >
          @if (book.imagenUrl) {
            <img
              [src]="book.imagenUrl"
              [alt]="book.titulo"
              class="w-full h-full object-fill group-hover:scale-105 transition-transform duration-500"
              onerror="
                this.style.display = 'none';
                this.nextElementSibling.style.display = 'flex';
              "
            />
            <div
              class="hidden w-full h-full bg-gradient-to-b from-slate-700 to-slate-900 p-4 flex-col items-center justify-center text-center absolute inset-0"
            >
              <span
                class="font-serif font-bold text-white text-sm leading-tight"
                >{{ book.titulo }}</span
              >
            </div>
          } @else {
            <div
              class="w-full h-full bg-gradient-to-tr from-primary to-primary-focus p-4 flex flex-col items-center justify-center text-center absolute inset-0"
            >
              <div
                class="absolute left-2 top-0 bottom-0 w-1 bg-white/20 shadow-sm"
              ></div>

              <h3
                class="font-serif font-bold text-white text-sm drop-shadow-md leading-snug line-clamp-4 px-1"
              >
                {{ book.titulo }}
              </h3>

              <div class="mt-auto pt-2 border-t border-white/20 w-1/2">
                <p class="text-[10px] text-white/80 uppercase tracking-widest">
                  UG
                </p>
              </div>
            </div>
          }

          <div class="absolute top-2 right-2 z-20">
            @if (book.stock > 0) {
              <div
                class="badge badge-success badge-sm text-white font-bold shadow-sm gap-1 border-none bg-green-500/90 backdrop-blur-sm"
              >
                {{ book.stock }}
              </div>
            } @else {
              <div
                class="badge badge-error badge-sm text-white font-bold shadow-sm"
              >
                Agotado
              </div>
            }
          </div>
        </figure>

        <div class="card-body p-3 flex-grow gap-1">
          <h2
            class="font-bold text-sm leading-tight line-clamp-2 h-10"
            [title]="book.titulo"
          >
            {{ book.titulo }}
          </h2>

          <p class="text-xs text-gray-500 truncate mb-2">
            {{ book.autor }}
          </p>

          <div class="card-actions justify-center mt-auto">
            @if (isAdmin) {
              <button
                class="btn btn-primary btn-sm w-full min-h-0 h-9 text-xs shadow-sm"
                [disabled]="book.stock === 0"
                (click)="abrirModal(book)"
              >
                @if (book.stock > 0) {
                  Registrar Préstamo
                } @else {
                  Sin Stock
                }
              </button>
            } @else {
              @if (book.stock > 0) {
                <button
                  class="btn btn-outline btn-success btn-sm w-full min-h-0 h-9 text-xs pointer-events-none"
                >
                  Disponible
                </button>
              } @else {
                <button
                  class="btn btn-disabled btn-sm w-full min-h-0 h-9 text-xs bg-base-200"
                >
                  Agotado
                </button>
              }
            }
          </div>
        </div>
      </div>
    } @empty {
      @if (!loading) {
        <div
          class="col-span-full flex flex-col items-center justify-center py-20 opacity-50"
        >
          <p class="text-xl font-bold">No hay libros disponibles.</p>
        </div>
      }
    }
  </div>

  <book-loan-modal (loanConfirmed)="cargarLibros()"></book-loan-modal>

  <app-books-register-modal
    (bookCreated)="cargarLibros()"
  ></app-books-register-modal>
</div>
